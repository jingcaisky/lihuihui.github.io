<!-- åˆ†ç±»ç®¡ç†é¢æ¿ -->
<div id="category-panel" class="panel">
    <div class="search-panel">
        <div class="panel-title">ğŸ“ èµ„æºåˆ†ç±»ç®¡ç†</div>
        
        <!-- åˆ†ç±»ç»Ÿè®¡ -->
        <div class="category-stats">
            <div class="category-item" onclick="showCategory('characters')">
                <div class="category-icon">ğŸ‘¤</div>
                <div class="category-info">
                    <div class="category-name">è§’è‰²ç±»</div>
                    <div class="category-count">128 ä¸ªèµ„æº</div>
                </div>
            </div>
            <div class="category-item" onclick="showCategory('weapons')">
                <div class="category-icon">âš”ï¸</div>
                <div class="category-info">
                    <div class="category-name">æ­¦å™¨ç±»</div>
                    <div class="category-count">75 ä¸ªèµ„æº</div>
                </div>
            </div>
            <div class="category-item" onclick="showCategory('armor')">
                <div class="category-icon">ğŸ›¡ï¸</div>
                <div class="category-info">
                    <div class="category-name">æŠ¤ç”²ç±»</div>
                    <div class="category-count">42 ä¸ªèµ„æº</div>
                </div>
            </div>
            <div class="category-item" onclick="showCategory('environments')">
                <div class="category-icon">ğŸ°</div>
                <div class="category-info">
                    <div class="category-name">ç¯å¢ƒç±»</div>
                    <div class="category-count">156 ä¸ªèµ„æº</div>
                </div>
            </div>
            <div class="category-item" onclick="showCategory('ui_elements')">
                <div class="category-icon">ğŸ¨</div>
                <div class="category-info">
                    <div class="category-name">UIå…ƒç´ </div>
                    <div class="category-count">63 ä¸ªèµ„æº</div>
                </div>
            </div>
            <div class="category-item" onclick="showCategory('effects')">
                <div class="category-icon">âœ¨</div>
                <div class="category-info">
                    <div class="category-name">ç‰¹æ•ˆç±»</div>
                    <div class="category-count">37 ä¸ªèµ„æº</div>
                </div>
            </div>
        </div>

        <!-- åˆ†ç±»æ“ä½œæŒ‰é’® -->
        <div class="category-controls">
            <button class="control-button primary" onclick="showManualClassification()">ğŸ“ æ‰‹åŠ¨åˆ†ç±»</button>
            <button class="control-button primary" onclick="showBatchRename()">ğŸ·ï¸ æ‰¹é‡é‡å‘½å</button>
            <button class="control-button secondary" onclick="rescanCategories()">ğŸ”„ é‡æ–°æ‰«æ</button>
            <button class="control-button secondary" onclick="exportStatistics()">ğŸ“Š å¯¼å‡ºç»Ÿè®¡</button>
        </div>

        <!-- å½“å‰åˆ†ç±»å†…å®¹ -->
        <div class="category-content">
            <div class="category-header">
                <h3 id="current-category-name">è§’è‰²ç±»</h3>
                <div class="category-actions">
                    <button class="action-button" onclick="selectAllInCategory()">å…¨é€‰</button>
                    <button class="action-button" onclick="moveSelectedToCategory()">ç§»åŠ¨åˆ°åˆ†ç±»</button>
                    <button class="action-button" onclick="deleteSelected()">åˆ é™¤é€‰ä¸­</button>
                </div>
            </div>
            
            <div class="resource-grid" id="category-resources">
                <!-- è§’è‰²ç±»èµ„æº -->
                <div class="resource-item" data-category="characters">
                    <input type="checkbox" class="resource-checkbox">
                    <div class="resource-preview">ğŸ‘¤</div>
                    <div class="resource-name">æˆ˜å£«.fbx</div>
                    <div class="resource-meta">15.2MB | FBX</div>
                </div>
                <div class="resource-item" data-category="characters">
                    <input type="checkbox" class="resource-checkbox">
                    <div class="resource-preview">ğŸ§™</div>
                    <div class="resource-name">æ³•å¸ˆ.fbx</div>
                    <div class="resource-meta">12.8MB | FBX</div>
                </div>
                <div class="resource-item" data-category="characters">
                    <input type="checkbox" class="resource-checkbox">
                    <div class="resource-preview">ğŸ—¡ï¸</div>
                    <div class="resource-name">ç›—è´¼.fbx</div>
                    <div class="resource-meta">11.5MB | FBX</div>
                </div>
                <div class="resource-item" data-category="characters">
                    <input type="checkbox" class="resource-checkbox">
                    <div class="resource-preview">ğŸ¹</div>
                    <div class="resource-name">å¼“ç®­æ‰‹.fbx</div>
                    <div class="resource-meta">13.2MB | FBX</div>
                </div>
                <div class="resource-item" data-category="characters">
                    <input type="checkbox" class="resource-checkbox">
                    <div class="resource-preview">âš”ï¸</div>
                    <div class="resource-name">éª‘å£«.fbx</div>
                    <div class="resource-meta">16.8MB | FBX</div>
                </div>
                <div class="resource-item" data-category="characters">
                    <input type="checkbox" class="resource-checkbox">
                    <div class="resource-preview">â›‘ï¸</div>
                    <div class="resource-name">ç‰§å¸ˆ.fbx</div>
                    <div class="resource-meta">14.1MB | FBX</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- æ‰‹åŠ¨åˆ†ç±»å¯¹è¯æ¡† -->
<div id="manual-classification-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ğŸ“ æ‰‹åŠ¨åˆ†ç±»</h3>
            <button class="close-button" onclick="closeModal('manual-classification-modal')">Ã—</button>
        </div>
        <div class="modal-body">
            <div class="classification-form">
                <div class="form-group">
                    <label>é€‰æ‹©èµ„æº:</label>
                    <div class="selected-resources" id="selected-resources-list">
                        <!-- é€‰ä¸­çš„èµ„æºå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>
                <div class="form-group">
                    <label>ç›®æ ‡åˆ†ç±»:</label>
                    <select id="target-category" class="form-select">
                        <option value="characters">è§’è‰²ç±»</option>
                        <option value="weapons">æ­¦å™¨ç±»</option>
                        <option value="armor">æŠ¤ç”²ç±»</option>
                        <option value="environments">ç¯å¢ƒç±»</option>
                        <option value="ui_elements">UIå…ƒç´ </option>
                        <option value="effects">ç‰¹æ•ˆç±»</option>
                        <option value="misc">å…¶ä»–</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ“ä½œ:</label>
                    <div class="operation-options">
                        <label><input type="radio" name="operation" value="move" checked> ç§»åŠ¨åˆ°åˆ†ç±»</label>
                        <label><input type="radio" name="operation" value="copy"> å¤åˆ¶åˆ°åˆ†ç±»</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="control-button primary" onclick="applyClassification()">åº”ç”¨åˆ†ç±»</button>
            <button class="control-button secondary" onclick="closeModal('manual-classification-modal')">å–æ¶ˆ</button>
        </div>
    </div>
</div>

<!-- æ‰¹é‡é‡å‘½åå¯¹è¯æ¡† -->
<div id="batch-rename-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ğŸ·ï¸ æ‰¹é‡é‡å‘½å</h3>
            <button class="close-button" onclick="closeModal('batch-rename-modal')">Ã—</button>
        </div>
        <div class="modal-body">
            <div class="rename-form">
                <div class="form-group">
                    <label>é‡å‘½åè§„åˆ™:</label>
                    <select id="rename-rule" class="form-select">
                        <option value="prefix">æ·»åŠ å‰ç¼€</option>
                        <option value="suffix">æ·»åŠ åç¼€</option>
                        <option value="replace">æ›¿æ¢æ–‡æœ¬</option>
                        <option value="number">æ·»åŠ åºå·</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ–‡æœ¬å†…å®¹:</label>
                    <input type="text" id="rename-text" class="form-input" placeholder="è¾“å…¥è¦æ·»åŠ æˆ–æ›¿æ¢çš„æ–‡æœ¬">
                </div>
                <div class="form-group">
                    <label>é¢„è§ˆ:</label>
                    <div class="rename-preview" id="rename-preview">
                        <!-- é‡å‘½åé¢„è§ˆå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="control-button primary" onclick="applyRename()">åº”ç”¨é‡å‘½å</button>
            <button class="control-button secondary" onclick="closeModal('batch-rename-modal')">å–æ¶ˆ</button>
        </div>
    </div>
</div>

<style>
/* åˆ†ç±»ç®¡ç†é¢æ¿æ ·å¼ */
.category-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.category-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: rgba(44, 62, 80, 0.5);
    border: 1px solid #7F8C8D;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.category-item:hover {
    border-color: #E67E22;
    background: rgba(230, 126, 34, 0.1);
}

.category-item.active {
    border-color: #E67E22;
    background: rgba(230, 126, 34, 0.2);
}

.category-icon {
    font-size: 32px;
    width: 50px;
    text-align: center;
}

.category-info {
    flex: 1;
}

.category-name {
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 5px;
}

.category-count {
    font-size: 12px;
    color: #BDC3C7;
}

.category-controls {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}

.category-content {
    background: rgba(44, 62, 80, 0.3);
    border-radius: 6px;
    padding: 20px;
}

.category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #7F8C8D;
}

.category-header h3 {
    color: #E67E22;
    font-size: 20px;
}

.category-actions {
    display: flex;
    gap: 10px;
}

.resource-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
}

.resource-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px;
    background: rgba(52, 73, 94, 0.5);
    border: 1px solid #7F8C8D;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.resource-item:hover {
    border-color: #E67E22;
    background: rgba(230, 126, 34, 0.1);
}

.resource-checkbox {
    position: absolute;
    top: 10px;
    left: 10px;
    width: 18px;
    height: 18px;
}

.resource-preview {
    font-size: 48px;
    margin-bottom: 10px;
}

.resource-name {
    font-size: 14px;
    font-weight: bold;
    text-align: center;
    margin-bottom: 5px;
    word-break: break-all;
}

.resource-meta {
    font-size: 11px;
    color: #BDC3C7;
    text-align: center;
}

/* æ¨¡æ€æ¡†æ ·å¼ */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
}

.modal.show {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: #34495E;
    border: 1px solid #E67E22;
    border-radius: 8px;
    width: 90%;
    max-width: 500px;
    max-height: 80vh;
    overflow-y: auto;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid #7F8C8D;
}

.modal-header h3 {
    color: #E67E22;
    margin: 0;
}

.close-button {
    background: none;
    border: none;
    color: #ECF0F1;
    font-size: 24px;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.close-button:hover {
    color: #E67E22;
}

.modal-body {
    padding: 20px;
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    padding: 20px;
    border-top: 1px solid #7F8C8D;
}

.classification-form, .rename-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.selected-resources {
    max-height: 150px;
    overflow-y: auto;
    border: 1px solid #7F8C8D;
    border-radius: 4px;
    padding: 10px;
    background: rgba(44, 62, 80, 0.3);
}

.selected-resource {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
    border-bottom: 1px solid #7F8C8D;
}

.selected-resource:last-child {
    border-bottom: none;
}

.operation-options {
    display: flex;
    gap: 20px;
}

.operation-options label {
    display: flex;
    align-items: center;
    gap: 5px;
    cursor: pointer;
}

.rename-preview {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #7F8C8D;
    border-radius: 4px;
    padding: 10px;
    background: rgba(44, 62, 80, 0.3);
}

.rename-preview-item {
    padding: 5px 0;
    border-bottom: 1px solid #7F8C8D;
    font-size: 12px;
}

.rename-preview-item:last-child {
    border-bottom: none;
}

.rename-preview-item .old-name {
    color: #E74C3C;
    text-decoration: line-through;
}

.rename-preview-item .new-name {
    color: #2ECC71;
    font-weight: bold;
}
</style>

<script>
// åˆ†ç±»ç®¡ç†åŠŸèƒ½
let currentCategory = 'characters';

function showCategory(category) {
    currentCategory = category;
    
    // æ›´æ–°åˆ†ç±»é¡¹çŠ¶æ€
    document.querySelectorAll('.category-item').forEach(item => {
        item.classList.remove('active');
    });
    event.target.closest('.category-item').classList.add('active');
    
    // æ›´æ–°åˆ†ç±»åç§°
    const categoryNames = {
        'characters': 'è§’è‰²ç±»',
        'weapons': 'æ­¦å™¨ç±»',
        'armor': 'æŠ¤ç”²ç±»',
        'environments': 'ç¯å¢ƒç±»',
        'ui_elements': 'UIå…ƒç´ ',
        'effects': 'ç‰¹æ•ˆç±»'
    };
    
    document.getElementById('current-category-name').textContent = categoryNames[category];
    
    // æ˜¾ç¤ºå¯¹åº”åˆ†ç±»çš„èµ„æº
    showCategoryResources(category);
}

function showCategoryResources(category) {
    const resourceGrid = document.getElementById('category-resources');
    const resources = getResourcesByCategory(category);
    
    resourceGrid.innerHTML = resources.map(resource => `
        <div class="resource-item" data-category="${category}">
            <input type="checkbox" class="resource-checkbox">
            <div class="resource-preview">${resource.icon}</div>
            <div class="resource-name">${resource.name}</div>
            <div class="resource-meta">${resource.size} | ${resource.format}</div>
        </div>
    `).join('');
}

function getResourcesByCategory(category) {
    const resources = {
        'characters': [
            { icon: 'ğŸ‘¤', name: 'æˆ˜å£«.fbx', size: '15.2MB', format: 'FBX' },
            { icon: 'ğŸ§™', name: 'æ³•å¸ˆ.fbx', size: '12.8MB', format: 'FBX' },
            { icon: 'ğŸ—¡ï¸', name: 'ç›—è´¼.fbx', size: '11.5MB', format: 'FBX' },
            { icon: 'ğŸ¹', name: 'å¼“ç®­æ‰‹.fbx', size: '13.2MB', format: 'FBX' },
            { icon: 'âš”ï¸', name: 'éª‘å£«.fbx', size: '16.8MB', format: 'FBX' },
            { icon: 'â›‘ï¸', name: 'ç‰§å¸ˆ.fbx', size: '14.1MB', format: 'FBX' }
        ],
        'weapons': [
            { icon: 'âš”ï¸', name: 'é•¿å‰‘.blend', size: '4.7MB', format: 'Blend' },
            { icon: 'ğŸ¹', name: 'é•¿å¼“.blend', size: '3.2MB', format: 'Blend' },
            { icon: 'ğŸª„', name: 'æ³•æ–.blend', size: '5.1MB', format: 'Blend' },
            { icon: 'ğŸ—¡ï¸', name: 'åŒ•é¦–.blend', size: '2.8MB', format: 'Blend' }
        ],
        'armor': [
            { icon: 'ğŸ›¡ï¸', name: 'ç›¾ç‰Œ.blend', size: '6.3MB', format: 'Blend' },
            { icon: 'â›‘ï¸', name: 'å¤´ç›”.blend', size: '4.2MB', format: 'Blend' },
            { icon: 'ğŸ¦º', name: 'èƒ¸ç”².blend', size: '8.7MB', format: 'Blend' }
        ],
        'environments': [
            { icon: 'ğŸ°', name: 'åŸå ¡.obj', size: '32.1MB', format: 'OBJ' },
            { icon: 'ğŸŒ²', name: 'æ£®æ—.blend', size: '28.5MB', format: 'Blend' },
            { icon: 'ğŸ”ï¸', name: 'å±±è„‰.obj', size: '45.2MB', format: 'OBJ' }
        ],
        'ui_elements': [
            { icon: 'ğŸ¨', name: 'å›¾æ ‡åŒ….png', size: '2.3MB', format: 'PNG' },
            { icon: 'ğŸ”˜', name: 'æŒ‰é’®.png', size: '1.8MB', format: 'PNG' },
            { icon: 'ğŸ“Š', name: 'ç•Œé¢.png', size: '3.1MB', format: 'PNG' }
        ],
        'effects': [
            { icon: 'âœ¨', name: 'é­”æ³•ç‰¹æ•ˆ.blend', size: '12.5MB', format: 'Blend' },
            { icon: 'ğŸ’¥', name: 'çˆ†ç‚¸æ•ˆæœ.blend', size: '8.9MB', format: 'Blend' },
            { icon: 'ğŸŒŸ', name: 'ç²’å­ç³»ç»Ÿ.blend', size: '15.7MB', format: 'Blend' }
        ]
    };
    
    return resources[category] || [];
}

function selectAllInCategory() {
    const checkboxes = document.querySelectorAll('.resource-checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.checked = true;
    });
}

function moveSelectedToCategory() {
    const selectedResources = getSelectedResources();
    if (selectedResources.length === 0) {
        alert('è¯·å…ˆé€‰æ‹©è¦ç§»åŠ¨çš„èµ„æº');
        return;
    }
    
    showModal('manual-classification-modal');
    updateSelectedResourcesList(selectedResources);
}

function deleteSelected() {
    const selectedResources = getSelectedResources();
    if (selectedResources.length === 0) {
        alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„èµ„æº');
        return;
    }
    
    if (confirm(`ç¡®å®šè¦åˆ é™¤ ${selectedResources.length} ä¸ªé€‰ä¸­çš„èµ„æºå—ï¼Ÿ`)) {
        selectedResources.forEach(resource => {
            resource.closest('.resource-item').remove();
        });
    }
}

function getSelectedResources() {
    return Array.from(document.querySelectorAll('.resource-checkbox:checked'));
}

function updateSelectedResourcesList(selectedResources) {
    const list = document.getElementById('selected-resources-list');
    list.innerHTML = selectedResources.map(checkbox => {
        const resourceItem = checkbox.closest('.resource-item');
        const name = resourceItem.querySelector('.resource-name').textContent;
        return `
            <div class="selected-resource">
                <span>${name}</span>
                <button class="action-button" onclick="removeFromSelection(this)">ç§»é™¤</button>
            </div>
        `;
    }).join('');
}

function removeFromSelection(button) {
    button.closest('.selected-resource').remove();
}

function showManualClassification() {
    const selectedResources = getSelectedResources();
    if (selectedResources.length === 0) {
        alert('è¯·å…ˆé€‰æ‹©è¦åˆ†ç±»çš„èµ„æº');
        return;
    }
    
    showModal('manual-classification-modal');
    updateSelectedResourcesList(selectedResources);
}

function showBatchRename() {
    const selectedResources = getSelectedResources();
    if (selectedResources.length === 0) {
        alert('è¯·å…ˆé€‰æ‹©è¦é‡å‘½åçš„èµ„æº');
        return;
    }
    
    showModal('batch-rename-modal');
    updateRenamePreview();
}

function rescanCategories() {
    if (confirm('ç¡®å®šè¦é‡æ–°æ‰«ææ‰€æœ‰åˆ†ç±»å—ï¼Ÿè¿™å°†æ›´æ–°èµ„æºç»Ÿè®¡ä¿¡æ¯ã€‚')) {
        alert('æ­£åœ¨é‡æ–°æ‰«æåˆ†ç±»...');
        // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„é‡æ–°æ‰«æé€»è¾‘
    }
}

function exportStatistics() {
    alert('æ­£åœ¨å¯¼å‡ºåˆ†ç±»ç»Ÿè®¡ä¿¡æ¯...');
    // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„å¯¼å‡ºé€»è¾‘
}

function applyClassification() {
    const targetCategory = document.getElementById('target-category').value;
    const operation = document.querySelector('input[name="operation"]:checked').value;
    
    alert(`æ­£åœ¨${operation === 'move' ? 'ç§»åŠ¨' : 'å¤åˆ¶'}èµ„æºåˆ°${targetCategory}åˆ†ç±»...`);
    closeModal('manual-classification-modal');
}

function applyRename() {
    const rule = document.getElementById('rename-rule').value;
    const text = document.getElementById('rename-text').value;
    
    if (!text.trim()) {
        alert('è¯·è¾“å…¥é‡å‘½åæ–‡æœ¬');
        return;
    }
    
    alert(`æ­£åœ¨åº”ç”¨é‡å‘½åè§„åˆ™: ${rule} - ${text}`);
    closeModal('batch-rename-modal');
}

function updateRenamePreview() {
    const rule = document.getElementById('rename-rule').value;
    const text = document.getElementById('rename-text').value;
    const preview = document.getElementById('rename-preview');
    
    const selectedResources = getSelectedResources();
    preview.innerHTML = selectedResources.map(checkbox => {
        const resourceItem = checkbox.closest('.resource-item');
        const name = resourceItem.querySelector('.resource-name').textContent;
        let newName = name;
        
        switch (rule) {
            case 'prefix':
                newName = text + name;
                break;
            case 'suffix':
                const dotIndex = name.lastIndexOf('.');
                if (dotIndex > 0) {
                    newName = name.substring(0, dotIndex) + text + name.substring(dotIndex);
                } else {
                    newName = name + text;
                }
                break;
            case 'replace':
                newName = name.replace(/old/g, text);
                break;
            case 'number':
                newName = name.replace(/(\d+)/, text);
                break;
        }
        
        return `
            <div class="rename-preview-item">
                <span class="old-name">${name}</span> â†’ 
                <span class="new-name">${newName}</span>
            </div>
        `;
    }).join('');
}

function showModal(modalId) {
    document.getElementById(modalId).classList.add('show');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('show');
}

// ç›‘å¬é‡å‘½åè§„åˆ™å˜åŒ–
document.addEventListener('DOMContentLoaded', function() {
    const renameRule = document.getElementById('rename-rule');
    const renameText = document.getElementById('rename-text');
    
    if (renameRule && renameText) {
        renameRule.addEventListener('change', updateRenamePreview);
        renameText.addEventListener('input', updateRenamePreview);
    }
});
</script>
